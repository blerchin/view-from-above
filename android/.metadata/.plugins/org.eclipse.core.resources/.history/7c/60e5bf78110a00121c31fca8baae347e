package com.example.time_lapse_camera;

import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.net.URI;
import java.net.URL;
import java.net.URLConnection;

import android.os.AsyncTask;
import android.util.Log;

public class BatchToFTP extends AsyncTask<URI, Void, Long> {

	private String TAG = "BatchToFTP";
	private String destRoot;
	private URLConnection ftpConnection;
	private String FTP_ROOT = "mhzmaster.com/view_from_above_images/";
	private String FTP_USER = "view_from_above";
	private String FTP_PASS = "avast-spoon-candid";
	
	protected Long doInBackground(URI ... pictureUris ) {
		Log.d(TAG,"BatchToFTP Instance!");
			destRoot = "ftp://"+getText(R.string.ftp_upload_user)+":"+R.string.ftp_upload_pass+"@"+R.string.ftp_upload_loc;
		
		for ( URI p : pictureUris){
			try {
				Log.d(TAG, "trying a picture URI: " + p.toString());
				File jpeg = new File(p);
				
				URL urlOut = new URL( destRoot + jpeg.getName());
				Log.d(TAG,"url is: "+urlOut.toString());
				ftpConnection.setDoOutput(true);
				ftpConnection = urlOut.openConnection();
				Log.d(TAG,"Connection opened");
				BufferedOutputStream outStream = new BufferedOutputStream( ftpConnection.getOutputStream() );
				
				FileInputStream inStream =  new FileInputStream( new File(p) );
				byte[] buff = new byte[32*1024];
				int len;
				while ((len = inStream.read(buff)) > 0)
				      outStream.write(buff, 0, len);
				outStream.close();
				inStream.close();
				Log.d(TAG,"wrote file to FTP:"+urlOut.toString());
				
			} catch (IOException e){
				Log.d(TAG,"something went wrong while uploading the file: "+ e.getMessage());
				return Long.valueOf(0);
			}
		

		}
		return Long.valueOf(1);

	}
}